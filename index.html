<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Volvo განრიგი</title>
    
    <!-- Favicon linking -->
    <!-- App icon for mobile (when saved to home screen) -->
    <!-- App icon -->
    <link rel="apple-touch-icon" href="1.jpg">
    <link rel="icon" type="image/jpeg" href="1.jpg">

    <!-- Progressive Web App Metadata -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Volvo განრიგი">
    <meta name="theme-color" content="#ffffff">
    <link rel="apple-touch-icon" href="1.jpg">
    <link rel="manifest" href="manifest.json">

    <!-- Favicon for browsers -->
    <link rel="icon" type="image/jpeg" href="1.jpg">

    <!-- Progressive Web App metadata -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="App Name">
    <link rel="icon" href="1.jpg" type="image/jpg">
    <link rel="icon" href="1.png" type="image/png">
    <!-- Web App Manifest linking -->
    <link rel="manifest" href="manifest.json">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root {
    --primary-color: #1e3a8a;
    --work-day: #22c55e;
    --rest-day: #ffffff;
    --past-work-day: #6b7280; /* Darker purple for past green (work) days */
    --past-rest-day: #d8b4fe; /* Lighter purple for past white (rest) days */
    --text-color: #1f2937;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #f3f4f6, #bfdbfe);
            min-height: 100vh;
            padding: 10px;
            color: var(--text-color);
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 10px;
        }

        h1 {
            font-size: 1.8rem;
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .message-container {
            background: white;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 15px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            font-weight: 500;
            text-align: center;
            font-size: 1rem;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .nav-button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.3s;
            flex: 1;
            max-width: 120px;
            text-align: center;
        }

        .nav-button:active {
            background: #1e40af;
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .date-cell {
            padding: 10px;
            text-align: center;
            border-radius: 6px;
            font-size: 0.85rem;
            line-height: 1.4;
            transition: transform 0.2s;
        }

        .date-cell:active {
            transform: scale(0.95);
        }

        .green {
            background-color: var(--work-day);
            color: white;
        }

        .white {
            background-color: var(--rest-day);
            color: var(--text-color);
        }

        .past-green {
            background-color: var(--past-work-day);
            color: white;
        }

        .past-white {
            background-color: var(--past-rest-day);
            color: var(--text-color);
        }

        .weekday-header {
            font-weight: bold;
            text-align: center;
            padding: 8px;
            color: var(--primary-color);
            font-size: 0.85rem;
        }

        /* Mobile Styles */
        @media (max-width: 600px) {
            h1 {
                font-size: 1.4rem;
            }

            .calendar {
                grid-template-columns: repeat(2, 1fr);
                gap: 4px;
                padding: 8px;
            }

            .date-cell {
                padding: 8px;
                font-size: 0.8rem;
            }

            .weekday-header {
                font-size: 0.75rem;
                padding: 6px;
            }

            .message-container {
                font-size: 0.9rem;
                padding: 8px;
            }

            .nav-button {
                padding: 6px 12px;
                font-size: 0.8rem;
                max-width: 100px;
            }
        }

        @media (max-width: 400px) {
            .calendar {
                grid-template-columns: 1fr;
            }

            .weekday-header {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Volvo განრიგი</h1>
        <div class="message-container" id="message"></div>
        <div class="navigation">
            <button class="nav-button" onclick="prevMonth()">წინა თვე</button>
            <span id="current-month"></span>
            <button class="nav-button" onclick="nextMonth()">შემდეგი თვე</button>
        </div>
        <div class="calendar" id="calendar"></div>
    </div>

    <script>
        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/service-worker.js')
                .then(registration => {
                    console.log('Service Worker registered:', registration);
                    if (registration.waiting) {
                        registration.waiting.postMessage({ type: 'SKIP_WAITING' });
                    }
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                console.log('New version available. Reloading...');
                                window.location.reload();
                            }
                        });
                    });
                })
                .catch(error => {
                    console.error('Service Worker registration failed:', error);
                });
        }

        // Calendar Logic
        const months = ["იანვარი", "თებერვალი", "მარტი", "აპრილი", "მაისი", "ივნისი", "ივლისი", "აგვისტო", "სექტემბერი", "ოქტომბერი", "ნოემბერი", "დეკემბერი"];
        const weekdays = ["კვი", "ორშ", "სამ", "ოთხ", "ხუთ", "პარ", "შაბ"];
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        const startDate = new Date("2025-08-02"); // Starting point for the schedule
        const endDate = new Date("2025-12-31"); // End date for the schedule

        function generateCalendar() {
            const calendarContainer = document.getElementById("calendar");
            const messageContainer = document.getElementById("message");
            const currentMonthDisplay = document.getElementById("current-month");
            calendarContainer.innerHTML = '';

            // Add weekday headers
            if (window.innerWidth > 400) {
                weekdays.forEach(day => {
                    const header = document.createElement("div");
                    header.classList.add("weekday-header");
                    header.innerText = day;
                    calendarContainer.appendChild(header);
                });
            }

            // Calculate dates for the current month
            const monthStart = new Date(currentYear, currentMonth, 1);
            const monthEnd = new Date(currentYear, currentMonth + 1, 0);
            const currentDateObj = new Date();
            const tomorrowDateObj = new Date(currentDateObj);
            tomorrowDateObj.setDate(currentDateObj.getDate() + 1);

            // Set current month display
            currentMonthDisplay.innerText = `${months[currentMonth]} ${currentYear}`;

            // Add empty cells for days before the 1st
            const firstDay = monthStart.getDay();
            for (let i = 0; i < firstDay; i++) {
                const emptyCell = document.createElement("div");
                calendarContainer.appendChild(emptyCell);
            }

            // Calculate days since startDate for work/rest cycle
            let currentDate = new Date(monthStart);
            while (currentDate <= monthEnd) {
                const dateCell = document.createElement("div");
                dateCell.classList.add("date-cell");

                // Calculate days since startDate
                const timeDiff = currentDate - startDate;
                const daysSinceStart = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                const cycleDay = daysSinceStart % 4; // 4-day cycle (2 work, 2 rest)

                // Apply work/rest day styles
                if (cycleDay < 2) {
                    dateCell.classList.add("green"); // Work days
                } else {
                    dateCell.classList.add("white"); // Rest days
                }

                const day = currentDate.getDate();
                const weekday = weekdays[currentDate.getDay()];
                dateCell.innerText = `${day}\n${weekday}`;

                // Past days
                if (currentDate < currentDateObj) {
                    if (dateCell.classList.contains("green")) {
                        dateCell.classList.remove("green");
                        dateCell.classList.add("past-green");
                    } else if (dateCell.classList.contains("white")) {
                        dateCell.classList.remove("white");
                        dateCell.classList.add("past-white");
                    }
                }

                // Tomorrow message
                if (
                    currentDate.getFullYear() === tomorrowDateObj.getFullYear() &&
                    currentDate.getMonth() === tomorrowDateObj.getMonth() &&
                    currentDate.getDate() === tomorrowDateObj.getDate()
                ) {
                    messageContainer.innerHTML = dateCell.classList.contains("green")
                        ? "ხვალ მუშაობ 😱"
                        : "ხვალ არ მუშაობ 😍🥳";
                }

                calendarContainer.appendChild(dateCell);
                currentDate.setDate(currentDate.getDate() + 1);
            }
        }

        function prevMonth() {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            generateCalendar();
        }

        function nextMonth() {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            generateCalendar();
        }

        // Initial calendar generation
        generateCalendar();

        // Update calendar on window resize
        window.addEventListener('resize', generateCalendar);
    </script>
</body>
</html>

